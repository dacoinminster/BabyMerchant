<!DOCTYPE html>
<html>
<head>

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-177414002-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-177414002-1');
	</script>

	<meta charset="UTF-8"/>
	<!--
		ðŸ‘¶ Baby Merchant ðŸ‘¶

		A text trading game (and sin against best practices) by J.R. Willett (https://www.linkedin.com/in/jrwillett/)
		Inspired by:
		A Dark Room http://adarkroom.doublespeakgames.com/
		Universal Paperclip https://www.decisionproblem.com/paperclips/
		Candy Box 2 https://candybox2.github.io/candybox/
		Taipan! https://en.wikipedia.org/wiki/Taipan
		Desert Trader, specifically the Apple IIGS version: https://www.reddit.com/r/tipofmytongue/comments/hh2exu/tomtgamelate_80s_to_early_90s_pc_game_about/
		Galactic Conquest (https://www.galcon.com/classic/history.html), specifically the 1991 version for the Apple IIGS by David Hallwas, which the internet has forgotten

		Goals I'd like to implement:
		* Each level adds a new gameplay wrinkle
		* Health, Battles, Upgradeable weapons and/or number of weapons
			* Weapons should take cargo space
		* Borrowing from a money lender
		* Banking Deposits
		* Owning multiple ships
		* Gaining/Losing territory to rivals
		* Karma from doing good or bad things affects luck?
		* Travel down into massive number of consistently named subworlds
				* Maybe to earn karma?
				* Buy upgrades with absurd amoumts of currency from higher levels
				* Find artifacts based on clues discovered at higher levels
		* Trading affects supply/demand? (My trading actions affect prices?)
		* Prices trending over time?
\		* Narration needs more voice/humor
		* Would be cool to have some disturbing art - maybe ASCII?
		* 'glowing pill' mechanic allows expensive upgrades that restart the game with perks - only shows up when you can afford it
		   * Booger pill, Gossip pill


		TODOs resulting from play testing:
		* Need more play testing!
		* Feels awfully repetitive




	-->
	<title>Baby Merchant</title>
	<meta itemprop="description" name="description" property="og:description" content="A minimalist trading game">
	<meta itemprop="name" property="og:title" content="Baby Merchant" />

	<link rel="apple-touch-icon" sizes="57x57" href="images/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="images/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="images/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="images/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="images/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="images/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="images/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="images/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="images/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="images/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="images/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
	<link rel="manifest" href="images/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="images/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

<!-- From https://github.com/davidbau/seedrandom -->
<script src='seedrandom.min.js'>
</script>

<script src='nameGenerator.js'>
</script>

<script src='bigNumbers.js'>
</script>

<script type='text/javascript'>

'use strict';

Math.seedrandom()	// Start out truly random
var buttonAction = ''
var basePrice = [1,10,100,1000]

function deepFreeze(object) {

  // Retrieve the property names defined on object
  var propNames = Object.getOwnPropertyNames(object);

  // Freeze properties before freezing self

  for (let name of propNames) {
    let value = object[name];

    if(value && typeof value === "object") {
      deepFreeze(value);
    }
  }

  return Object.freeze(object);
}

const levelData = [
	{
		levelDownMessage: "err",
		levelUpMessage: "You decide you are ready to roll to other groups of babies",
		levelUpAwesomeness: "You can choose your next destination and revisit places with favorable prices.",
		levelDownLabel: "err",
		levelUpLabel: "Roll to another group",
		discoveryMsg1: "You bump into another ",
		discoveryMsg2: " whom you decide should be named ",
		discoveryMsg3: ".",
		BossDiscoveryMsg1: "You found a ",
		BossDiscoveryMsg2: ", larger than the others, who babbles a name which might be \"",
		BossDiscoveryMsg3: "\". Here you can buy upgrades in exchange for ",
		BossDiscoveryMsg4: ". Perhaps you can trade with the other babies to get some.",
		ArrivalMsg1: "You arrive at ",
		ArrivalMsg2: "'s ",
		ExploreMsg: "Random limb movements propel you.",
		ExploreHdr: "Thrashing toward the unknown . . . ",
		RevisitMsg: "You thrash your limbs with purpose.",
		RevisitHdr1: "Thrashing toward ",
		RevisitHdr2: "'s ",
		VisitHdr1: "Trading at ",
		VisitHdr2: " ",
		VisitHdr3: "'s ",
		tradeableItems: ['crusty boogers (Æ€)', 'slimy boogers', 'bloody boogers', 'pieces of fuzz'],
		tradeableItemsSingular: ['crusty booger (Æ€)', 'slimy booger', 'bloody booger', 'piece of fuzz'],
		characterType: 'helpless baby',
		locomotionType: 'thrash',
		locationLabel: ['spot','spot','spot','spot','spot'],
		travelFasterUpgradeMsg: [" reaches into a nearby diaper and liberally applies grease to your back.", " shows you how to thrash about more efficiently."],
		travelFasterUpgradeDesc: ['Back Grease', 'Super Thrash'],
		cargoUpgradeMsg: ' teaches you how to grip 100 more boogers at once.',
		cargoUpgradeDesc: 'Tighter Grip',
		levelUpgradeMsg: ' teaches you how to roll over to travel further to reach other groups of babies.',
		levelUpgradeDesc: 'Roll Over',
		levelUpgradeHeaderMsg: "You learned to roll over!",
		loseMsg: 'As you thrashed your limbs, you accidentally flung away ',
		foundMsg: 'As you thrashed your limbs, you managed to find ',
		exploreMsg: 'You have visited every baby in this group and are starting to get better at thrashing about.',
		numLocations: 5,
	},
	{
		levelDownMessage: "You lie on your back and prepare to move by thrashing about",
		levelUpMessage: "You decide you are ready to crawl to other rooms of babies",
		levelUpAwesomeness: "Combat! (Coming soon)",
		levelDownLabel: "Enter ",
		levelUpLabel: "Crawl to another baby room",
		discoveryMsg1: "You roll to another ",
		discoveryMsg2: " who babbles a name which might be \"",
		discoveryMsg3: "\".",
		BossDiscoveryMsg1: "You roll up to a ",
		BossDiscoveryMsg2: ", larger than the others, who babbles a name which sounds like \"",
		BossDiscoveryMsg3: "\". Here you can buy upgrades in exchange for ",
		BossDiscoveryMsg4: ".",
		ArrivalMsg1: "You arrive at ",
		ArrivalMsg2: "'s ",
		ExploreMsg: "You roll awkwardly toward a new group.",
		ExploreHdr: "Rolling somewhere new . . . ",
		RevisitMsg: "You roll determinedly.",
		RevisitHdr1: "Rolling toward ",
		RevisitHdr2: "'s ",
		VisitHdr1: "Trading at ",
		VisitHdr2: " ",
		VisitHdr3: "'s ",
		tradeableItems: ['pieces of fuzz', 'paperclips', 'shiny beads', 'pacifiers'],
		tradeableItemsSingular: ['piece of fuzz', 'paperclip', 'shiny bead', 'pacifier'],
		characterType: 'wee baby',
		locomotionType: 'roll',
		locationLabel: ['doorway','group','group','group','group'],
		travelFasterUpgradeMsg: [" reaches into a nearby diaper and liberally applies grease to your tummy.", " shows you how to roll more efficiently."],
		travelFasterUpgradeDesc: ['Tummy Grease', 'Mega Roll'],
		cargoUpgradeMsg: ' violently stretches your cheeks. They will now hold 100 more items.',
		cargoUpgradeDesc: 'Stretchier Cheeks',
		levelUpgradeMsg: ' teaches you how to crawl and thereby reach other rooms.',
		levelUpgradeDesc: 'Crawl',
		levelUpgradeHeaderMsg: "You learned to crawl!",
		loseMsg: 'While rolling, you choked and accidentally swallowed ',
		foundMsg: 'While rolling, you managed to find ',
		exploreMsg: 'You have visited every group in this room and you notice your rolling skills have improved.',
		numLocations: 5,
	},
	{
		levelDownMessage: "You lie down, and prepare to move by rolling over",
		levelUpMessage: "You decide you are ready to ride the elevator to visit other floors full of babies",
		levelUpAwesomeness: "?????? (TBD, coming eventually)",
		levelDownLabel: "Enter ",
		levelUpLabel: "Use Elevator",
		discoveryMsg1: "You crawl to another ",
		discoveryMsg2: " who babbles a name which sounds like \"",
		discoveryMsg3: "\".",
		BossDiscoveryMsg1: "You crawl up to a ",
		BossDiscoveryMsg2: ", larger than the others, who babbles that their name is \"",
		BossDiscoveryMsg3: "\". Here you can buy upgrades in exchange for ",
		BossDiscoveryMsg4: ".",
		ArrivalMsg1: "You arrive at ",
		ArrivalMsg2: "'s ",
		ExploreMsg: "You crawl aimlessly toward a new doorway.",
		ExploreHdr: "Crawling somwhere new . . . ",
		RevisitMsg: "You crawl steadily.",
		RevisitHdr1: "Crawling toward ",
		RevisitHdr2: "'s ",
		VisitHdr1: "Trading at ",
		VisitHdr2: " ",
		VisitHdr3: "'s ",
		tradeableItems: ['pacifiers', 'building blocks', 'toy cars', 'candies'],
		tradeableItemsSingular: ['pacifier', 'building block', 'toy car', 'candy'],
		characterType: 'lil baby',
		locomotionType: 'crawl',
		locationLabel: ['elevator','doorway','doorway','doorway','doorway'],
		travelFasterUpgradeMsg: [" reaches into a nearby diaper and liberally applies grease to your elbows.", " shows you how to crawl more efficiently."],
		travelFasterUpgradeDesc: ['Elbow Grease', 'Hyper Crawl'],
		cargoUpgradeMsg: ' provides you with a roomier diaper.',
		cargoUpgradeDesc: 'Bigger Diaper',
		levelUpgradeMsg: ' teaches you how to push elevator buttons to access other floors.',
		levelUpgradeDesc: 'Use Elevator',
		levelUpgradeHeaderMsg: "You learned to use the elevator!",
		loseMsg: 'Your diaper loosened while crawling, and you lost ',
		foundMsg: 'You kept out a sharp eye while crawling and managed to find ',
		exploreMsg: 'You have visited every room on this floor and you notice your crawling skills have improved.',
		numLocations: 5,
	},
]
deepFreeze(levelData)

// These are the variables to save between sessions
var gameVersion = "0.1.0"
var gameSeed = Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)
var waitingTitleCards = 0
var waitingTitleHeader = []
var waitingTitleFooter = []
var waitingTitleText = []
var waitingTitleButton = []
var lastChar = ' '
var alreadyTyped = ''
var textBelow = ''
var textToType = []
var textToTypeBolded = []
var waitingMessagesToType = 0
var lastLineWasBold = false
var currLevel = 0
var locIndex = 0
var nextLocIndex = 1
var transitMoves = 4
var pickingEnabled = false
var tradingEnabled = false
var storeVisible = false
var upgradesVisible = false
var lastGameHTML = ""
var inv = [0,0,0,0]
var oldInv = []
var oldLocIndex = []
var travelTime = []
var visitedLocation = []
var cargoRoom = 100
var price = []
var locationName = []
var levelSeed = []
var levelChildSeed = []
var maxLevel = 0
var inventoryChanged = false
var showingGossipColors = false
var gossipLocation = 0
// End variables to save betweens sessions
const varsToSave = ['gameVersion', 'gameSeed', 'waitingTitleCards',
			'waitingTitleHeader', 'waitingTitleFooter', 'waitingTitleText',
			'waitingTitleButton', 'lastChar', 'alreadyTyped', 'textBelow',
			'textToType', 'textToTypeBolded', 'waitingMessagesToType',
			'lastLineWasBold', 'currLevel', 'locIndex', 'nextLocIndex', 'transitMoves',
			'pickingEnabled', 'tradingEnabled', 'storeVisible', 'upgradesVisible',
			'lastGameHTML', 'inv', 'oldInv', 'oldLocIndex', 'travelTime',
			'visitedLocation', 'cargoRoom', 'price', 'locationName', 'levelSeed',
			'levelChildSeed', 'maxLevel', 'inventoryChanged', 'showingGossipColors',
			'gossipLocation']
deepFreeze(varsToSave)

var PAUSE_MULT = 100 // Pause multiplier
var devMode = false
if(devMode) {
	gameSeed = 1
	PAUSE_MULT = 1
}

var typingText = false
var needToSave = false

function saveGameState() {
	lastGameHTML = document.getElementById('normalGameGoesHere').innerHTML

	// console.log("Starting save")
	for (const key of varsToSave) {
		// console.log("Saving " + key + "=" + JSON.stringify(window[key]))
		localStorage.setItem(key, JSON.stringify(window[key]))
	}
	needToSave = false
	// console.log("Save complete")
}

function loadGameState() {

	for (const key of varsToSave) {
		if(key != 'gameVersion') {
			// console.log(key + "=" + localStorage.getItem(key));
			var value = localStorage.getItem(key)
			if(value != null && value != 'undefined') {
				window[key] = JSON.parse(value)
			}
		}
	}

	document.getElementById('normalGameGoesHere').innerHTML = lastGameHTML

	document.getElementById('buttonIDlocomote').style.display = "block"
	document.getElementById('buttonIDlocomote').style.visiblity = "visible"
	document.getElementById('buttonIDlocomote').disabled = false
	if(currLevel > 0) {
		document.getElementById("destinationsAndLabel").style.display = "flex"
		document.getElementById('buttonIDpick').style.display = "none"
	} else {
		document.getElementById('buttonIDpick').style.display = "block"
		if(pickingEnabled) {
			document.getElementById('buttonIDpick').style.visibility = "visible"
			document.getElementById('buttonIDpick').disabled = false
		}
	}

	if(currLevel < maxLevel) {
		document.getElementById('buttonIDlevelUp').style.display = "block"
		document.getElementById('buttonIDlevelUp').style.visiblity = "visible"
	}

	if(currLevel > 0) {
		document.getElementById('buttonIDlevelDown').style.display = "block"
		document.getElementById('buttonIDlevelDown').style.visiblity = "visible"
	}

	setTimeout('goBaby()', 100)
	gtag('event', 'loadGame', {'event_category': 'gameState'})
}

Math.seedrandom(gameSeed)	// replaces Math.random with predictable pseudorandom generator

function isPunctuation(charToCheck) {
	return(charToCheck == '.' || charToCheck == ',' || charToCheck == '?' || charToCheck == '!' || charToCheck == ':' || charToCheck == ';')
}

function setupTitleCard(text, header, footer, button)  {
	document.getElementById("titleMainTextGoesHere").innerHTML = text.replace(/\n/g,'<br/>')
	document.getElementById("titleHeaderTextGoesHere").innerHTML = header
	if(button == "" && footer == "") {
		document.getElementById("titleCardFooter").style.display = "none"
	} else {
		document.getElementById("titleFooterTextGoesHere").innerHTML = footer
		document.getElementById("continueButton").innerHTML = button
		document.getElementById("titleCardFooter").style.display = "flex"
	}
	document.getElementById("normalGameGoesHere").style.display = "none"
	document.getElementById("titleCard").style.display = "flex"
}

function hideTitleCard() {
	if(waitingTitleCards > 0) {
		setupTitleCard(waitingTitleText[0], waitingTitleHeader[0], waitingTitleFooter[0], waitingTitleButton[0])
		for(i = 0; i < waitingTitleCards - 1; i++) {
			waitingTitleHeader[i] = waitingTitleHeader[i+1]
			waitingTitleFooter[i] = waitingTitleFooter[i+1]
			waitingTitleText[i] = waitingTitleText[i+1]
			waitingTitleButton[i] = waitingTitleButton[i+1]
		}
		waitingTitleCards--
	} else {
		document.getElementById("titleCard").style.display = "none"
		document.getElementById("normalGameGoesHere").style.display = "flex"
	}
}

function displayTitleCard(mainText, headerText, footerText, buttonText="OK") {
	// Make sure header is capitalized

	if(document.getElementById("titleCard").style.display == "flex") {
		// Already have a title card displayed, so queue this one up
		waitingTitleHeader[waitingTitleCards] = headerText
		waitingTitleFooter[waitingTitleCards] = footerText
		waitingTitleText[waitingTitleCards] = mainText
		waitingTitleButton[waitingTitleCards] = buttonText
		waitingTitleCards++
	} else {
		setupTitleCard(mainText, headerText, footerText, buttonText)
	}
}

function setHeaderText(newText) {
	document.getElementById("headerTextGoesHere").innerHTML = newText
	document.getElementById("headerGoesHere").style.display = "flex"
}

function setStatusText(newText) {
	document.getElementById("headerStatusGoesHere").innerHTML = newText
	document.getElementById("headerGoesHere").style.display = "flex"
}

function setInventoryHTML(newHTML) {
	document.getElementById("inventoryGoesHere").innerHTML = newHTML
	if(newHTML == "")
		document.getElementById("inventoryGoesHere").style.display = "none"
	else
		document.getElementById("inventoryGoesHere").style.display = "flex"
}

function setActionsHTML(newHTML) {
	document.getElementById("actionsGoHere").innerHTML = newHTML
	document.getElementById("actionsGoHere").style.display = "flex"
	document.getElementById("controlsGoHere").style.display = "flex"
}

function setDestinationsHTML(newHTML) {
	document.getElementById("destinationsGoHere").innerHTML = newHTML
}

function setOutputHTML(newHTML) {
	document.getElementById("outputGoesHere").innerHTML = newHTML
	document.getElementById("outputAndGradient").style.visibility = "visible"
}

function typeCharacter(characterToType, bolded) {
	if(characterToType == '\n') {
		if(lastLineWasBold) {
			textBelow = '<br><strong class="outputSpan">' + alreadyTyped + '</strong>' + textBelow
			lastLineWasBold = false
		} else {
			textBelow = '<br><span class="outputSpan">' + alreadyTyped + '</span>' + textBelow
		}
		alreadyTyped = ''
	} else {
		alreadyTyped += characterToType
	}
	if(bolded) {
		lastLineWasBold = true
		setOutputHTML('<strong class="outputSpan">' + alreadyTyped + '</strong>' + textBelow.substring(0,4000))
	} else {
		setOutputHTML('<span class="outputSpan">' + alreadyTyped + '</span>' + textBelow.substring(0,4000))
	}
}

function typeNextText() {
	var thisChar = textToType[0].substring(0,1)
	typeCharacter(thisChar, textToTypeBolded[0])
	textToType[0] = textToType[0].substring(1,textToType[0].length)
	var nextWait = 500
	if(textToType[0].length > 0) {
		var nextChar = textToType[0].substring(0,1)
		nextWait = 25 + Math.random()*50
		if(isPunctuation(lastChar) && !isPunctuation(thisChar)) {
			// Pause after punctuation
			nextWait += 200 + Math.random()*200
		} else if(thisChar != '\n' && nextChar == '\n') {
			// Pause before linebreak
			nextWait += 200 + Math.random()*200
		} else if(thisChar ==' ') {
			// Slight pause after space
			nextWait += 50 + Math.random()*50
		}
	} else {
		waitingMessagesToType--
		if(waitingMessagesToType > 0) {
			for(i = 0; i < waitingMessagesToType; i++) {
				textToType[i] = textToType[i+1]
				textToTypeBolded[i] = textToTypeBolded[i+1]
			}
		} else {
			typingText = false
			if(needToSave) {
				saveGameState()
			}
		}
	}
	lastChar = thisChar
	if(typingText) {
		if(devMode || true) {
			nextWait = nextWait / 100
		}
		setTimeout('typeNextText()', nextWait)
	}
}

// If titleCardFooter and/or titleCardHeader is passed, then text will be
// displayed as a title card with a header and footer and text will be bolded
// when user returns from title card
function typeText(whatToType, titleCardHeader = "", titleCardFooter = "", titleCardButton = "OK") {
	//textBelow = '<br><br>' + alreadyTyped + textBelow
	//alreadyTyped = ''
	var showTitleCard = (titleCardFooter.length > 0 || titleCardHeader.length > 0)
	if(showTitleCard) {
		titleCardHeader = titleCardHeader.charAt(0).toUpperCase() + titleCardHeader.slice(1)
		displayTitleCard(whatToType, titleCardHeader, titleCardFooter, titleCardButton)
		whatToType = titleCardHeader + " " + whatToType
	}
	textToType[waitingMessagesToType] = '\n\n' + whatToType
	textToTypeBolded[waitingMessagesToType] = showTitleCard
	waitingMessagesToType++
	if(!typingText) {
		typingText = true
		typeNextText()
	}
}

function setupLevel(index, seed, mainLocationName) {
	levelSeed[index] = seed
	Math.seedrandom(seed)
	levelChildSeed[index] = []
	for(var i = 1; i < levelData[index].numLocations; i++) {
		levelChildSeed[index][i] = Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)
	}
	locationName[index] = []
	locationName[index][0] = mainLocationName
	for(var i = 1; i < levelData[index].numLocations; i++) {
		locationName[index][i] = getRandomName()
	}
}

function setupLocationRadioButtons() {
	var rbHTML = '';
	for(var i = 0; i < levelData[currLevel].numLocations; i++) {
		rbHTML += '<div class="locChoice">'
		rbHTML += '<input class="locRadioButton" type="radio" id="nextLoc' + i + '" name="nextLoc" value="' + i + '"'
		rbHTML += ' onclick="updateLocomoteButton()"'
		if(i == nextLocIndex) rbHTML += ' checked'
		rbHTML +='>'
		rbHTML += '<label for="nextLoc' + i + '" '
		if(showingGossipColors) {
			if(i == gossipLocation) {
				rbHTML += "style='color:rgb(0,200,0);' "
			}
		}
		if(i == locIndex) {
			rbHTML += 'class="locRadioLabelDisabled">'
		} else {
			rbHTML += 'class="locRadioLabel">'
		}

		if(visitedLocation[currLevel][i]) {
			rbHTML += locationName[currLevel][i]
		} else {
			rbHTML += levelData[currLevel].locationLabel[i]
			if(i > 0) {
				rbHTML += "&nbsp;#" + i
			}
		}
		rbHTML += '</label></div>'
	}
	setDestinationsHTML(rbHTML)
}

function positiveExclamation() {
	var exclamationChoice = ["Good Joss!", "Yay!", "Hooray!", "Incredible!", "Yes!", "Fantastic!", "Lucky you!", "Fabulous!", "Excellent!", "Splendid!"]
	return exclamationChoice[Math.floor(Math.random()*exclamationChoice.length)]
}

function negativeExclamation() {
	var exclamationChoice = ["Bad Joss!", "Oh no!", "Boo!", "Terrible news!", "No!", "Bummer!", "Bad luck!", "Turnip farts!", "Dagnabbit!", "Poodoo!"]
	return exclamationChoice[Math.floor(Math.random()*exclamationChoice.length)]
}

function doButtonAction(actionName) {
	buttonAction = actionName
}

function getButtonHTML(actionName, buttonText) {
	return '<button class=babyButton id="buttonID' + actionName + '" onclick="doButtonAction(\'' + actionName +'\')">' + buttonText + '</button>'
}

function hasAnything() {
	for(var i = 0; i < inv.length; i++) {
		if(inv[i] > 0) return true
	}
	return false
}

function visitedAllLocations() {
	for(var i = 0; i < levelData[currLevel].numLocations; i++ ) {
		if(!visitedLocation[currLevel][i]) return false
	}
	return true
}

function getDisplayNumber(num, compact="") {
	var modIndex = Math.floor(Math.log10(num)/3) - 1
	if(compact != "") {
			var mod = ['k','m','b','t','qd','qn','sx','sp','oc','nn','dc']
			if(num < 1000 || compact != "super" && num < 2000) {
				return num.toLocaleString()
			} else if(modIndex < mod.length) {
				num /= Math.pow(1000,(modIndex+1))
				if(compact == "super") {
					return Math.round(num) + mod[modIndex]
				} else {
					return num.toPrecision(3) + mod[modIndex]
				}
			} else {
				if(compact == "super") {
					return num.toExponential(0)
				} else {
					return num.toExponential(2)
				}
			}
	} else {
		modIndex--
		if(num < 2000000) {
			return num.toLocaleString()
		} else if(modIndex < 998) {
				num /= Math.pow(1000,(modIndex+2))
				return num.toPrecision(4) + " " + numberScaleNameShortScale(modIndex+2)
		} else {
			return num.toExponential(5)
		}
	}
}

function calculateFreeSpace() {
	var freeSpace = cargoRoom
	for(var i = 0; i < inv.length; i++) {
		freeSpace -= inv[i]
	}
	return freeSpace
}

function handleLostAndFound() {
	var whaHappen = Math.random()
	if(whaHappen < 0.07) {
		// Lost something, mebbe
		var whichInv = inv.length - 1
		while(whichInv > 0 && Math.random() < 0.5) {
			whichInv--
		}
		var amount = Math.floor(Math.random()*inv[whichInv]*0.5)
		if(amount > 0) {
			inv[whichInv] -= amount
			var suggestion = " Perhaps if you learn to travel faster there will be fewer opportunities to lose your cargo."
			if(travelTime[currLevel] == 1) {
				suggestion = ""
			}
			if(amount == 1) {
				typeText(levelData[currLevel].loseMsg + " " +
								amount + " " + levelData[currLevel].tradeableItemsSingular[whichInv] + "!" + suggestion,
								levelData[currLevel].tradeableItemsSingular[whichInv] + " lost.",
								negativeExclamation())
			} else {
				typeText(levelData[currLevel].loseMsg + " " +
								amount + " " + levelData[currLevel].tradeableItems[whichInv] + "!" + suggestion,
								levelData[currLevel].tradeableItems[whichInv] + " lost.",
								negativeExclamation())
			}
		}
	} else if(whaHappen > 0.975 && hasAnything()) {
		var whichInv = 0
		while(whichInv < inv.length && Math.random() < 0.1) {
			whichInv++
		}
		var maxAmountFound = calculateFreeSpace() / 2
		var amount = Math.floor(Math.random()*maxAmountFound*0.5)
		if(amount > 0) {
			inv[whichInv] += amount
			if(amount == 1) {
				typeText(levelData[currLevel].foundMsg + " " +
								amount + " " + levelData[currLevel].tradeableItemsSingular[whichInv] + "!",
								levelData[currLevel].tradeableItemsSingular[whichInv] + " found.",
								positiveExclamation())
			} else {
				typeText(levelData[currLevel].foundMsg + " " +
								amount + " " + levelData[currLevel].tradeableItems[whichInv] + "!",
								levelData[currLevel].tradeableItems[whichInv] + " found.",
								positiveExclamation())
			}
		}
	}
}

function getNetWorth() {
	var netWorth = 0
	var lvlMultiplier = 1
	for(i = 0; i < currLevel; i++) {
		netWorth += lvlMultiplier * oldInv[i][0]
		for(j = 1; j < 4; j++) {
			lvlMultiplier *= 10
			netWorth += lvlMultiplier * oldInv[i][j]
		}
	}
	netWorth += lvlMultiplier * inv[0]
	for(j = 1; j < 4; j++) {
		lvlMultiplier *= 10
		netWorth += lvlMultiplier * inv[j]
	}
	for(i = currLevel + 1; i < levelData.length; i++) {
		netWorth += lvlMultiplier * oldInv[i][0]
		for(j = 1; j < 4; j++) {
			lvlMultiplier *= 10
			netWorth += lvlMultiplier * oldInv[i][j]
		}
	}
	return netWorth
}

function sellInv(index, quantity) {
	if(inv[index] >= quantity) {
		var thisPrice = price[currLevel][locIndex][index]
		inv[index] -= quantity
		inv[0] += quantity*thisPrice
		var sellMsg = "You sell " + getDisplayNumber(quantity) + " "
		if(quantity == 1) {
			sellMsg += levelData[currLevel].tradeableItemsSingular[index]
		} else {
			sellMsg += levelData[currLevel].tradeableItems[index]
		}
		sellMsg += " to get " + getDisplayNumber(quantity*thisPrice) + " "
		if(quantity*thisPrice == 1) {
			sellMsg += levelData[currLevel].tradeableItemsSingular[0]
		} else {
			sellMsg += levelData[currLevel].tradeableItems[0]
		}
		typeText(sellMsg)
		inventoryChanged = true
	} else {
		typeText("You do not have " + levelData[currLevel].tradeableItems[index] + " to sell")
	}
}

function buyInv(index, quantity) {
	var thisPrice = price[currLevel][locIndex][index]
	if(inv[0] >= quantity*thisPrice) {
		inv[index] += quantity
		inv[0] -= quantity*thisPrice
		var buyMsg = "You buy " + getDisplayNumber(quantity) + " "
		if(quantity == 1) {
			buyMsg += levelData[currLevel].tradeableItemsSingular[index]
		} else {
			buyMsg += levelData[currLevel].tradeableItems[index]
		}
		buyMsg += " for " + getDisplayNumber(quantity*thisPrice) + " "
		if(quantity*thisPrice == 1) {
			buyMsg += levelData[currLevel].tradeableItemsSingular[0]
		} else {
			buyMsg += levelData[currLevel].tradeableItems[0]
		}
		typeText(buyMsg)
		inventoryChanged = true
	} else {
		var shortBy = quantity*thisPrice - inv[0]
		var errMsg = "You need " + shortBy + " more "
		if(shortBy == 1) {
			errMsg += levelData[currLevel].tradeableItemsSingular[0]
		} else {
			errMsg += levelData[currLevel].tradeableItems[0]
		}
		typeText(errMsg)
	}
}

function getGossipText() {
	// console.log("Starting to figure out gossip")
	var gossipText = "Prices look unfavorable everywhere!"
	var msgCount = 0
	var thisBuyRatio = 1
	var bestBuyRatio = 1
	var thisProfit = 0
	var bestProfit = 0
	var bestBuyIndex = 0
	var bestSellIndex = 0
	var bestBuyLoc = 0
	var expensiveCount = 0
	for(var i = 3; i >= 0; i--) {
		if(inv[i] > 0) {
			// console.log ("Checking selling " + levelData[currLevel].tradeableItems[i])
			// Find good places to sell this
			if(i > 0) {
				// We don't already have a ton of the next less expensive item, so see about buying some
				for(var j = 1; j < levelData[currLevel].numLocations; j++) {
					for(var k = 0; k < i; k++) {
						// console.log (" and buying " + levelData[currLevel].tradeableItems[k] + " at " + locationName[currLevel][j])
						thisBuyRatio = price[currLevel][j][i] / (price[currLevel][j][k]*(10 ** (i-k)))
						if(thisBuyRatio > 1) {
							thisProfit = inv[i]*(thisBuyRatio-1) * (10 ** i)
							var actualSpace = cargoRoom - expensiveCount
							for(var m = k; m < i; m++) {
								actualSpace -= inv[m];
							}
							var neededSpace = (inv[i])*thisBuyRatio*(10 ** (i-k))+1
							// console.log("Needed space: " + neededSpace + ", original profit: " + thisProfit + ", actual space: " + actualSpace)
							neededSpace -= actualSpace
							var reduceCount = 0
							while(neededSpace > 0) {
								// Maybe if we don't sell one of them
								neededSpace = neededSpace - thisBuyRatio*(10 ** (i-k)) + 1
								thisProfit -= (thisBuyRatio-1) * (10 ** i)
								reduceCount++
							}
							// if(reduceCount > 0) {
							// 	console.log("reduced by " + reduceCount)
							// }
							// console.log("Expected profit: " + thisProfit)
							if(thisProfit > bestProfit) {
								bestProfit = thisProfit
								bestBuyIndex = k
								bestSellIndex = i
								bestBuyLoc = j
								bestBuyRatio = thisBuyRatio
							}
						}
					}
				}
			}
			expensiveCount += inv[i]
			if(i < 3) {
				// See about buying the more expensive item
				for(var j = 1; j < levelData[currLevel].numLocations; j++) {
					for(var k = i+1; k <= 3; k++) {
						// console.log (" and buying " + levelData[currLevel].tradeableItems[k] + " at " + locationName[currLevel][j])
						thisBuyRatio = (price[currLevel][j][i]*(10 ** (k-i))) / price[currLevel][j][k]
						if(thisBuyRatio > 1) {
							var buyCount = Math.floor(inv[i]*thisBuyRatio/(10 ** (k-i)))
							thisProfit = buyCount*(thisBuyRatio-1) * (10 ** k)
							// console.log("Expected profit: " + thisProfit)
							if(thisProfit > bestProfit) {
								bestProfit = thisProfit
								bestBuyIndex = k
								bestSellIndex = i
								bestBuyLoc = j
								bestBuyRatio = thisBuyRatio
							}
						}
					}
				}
			}
		}
	}

	// console.log(price[currLevel])
	if(bestProfit > 0) {
		var gossipSize = ""
		if(bestBuyRatio < 1.1) {
			gossipSize = "tolerable"
		} else if(bestBuyRatio < 1.2) {
			gossipSize = "ok"
		} else if(bestBuyRatio < 1.3) {
			gossipSize = "good"
		} else if(bestBuyRatio < 1.4) {
			gossipSize = "very good"
		} else if(bestBuyRatio < 1.6) {
			gossipSize = "great"
		} else {
			gossipSize = "fabulous"
		}
		// console.log(bestBuyLoc, bestProfit, bestBuyIndex, bestSellIndex, bestBuyRatio, gossipSize)
		gossipText = locationName[currLevel][bestBuyLoc] + " has " +
										gossipSize + " prices for those looking"
		if(bestSellIndex > 0) {
			gossipText += " to sell " + levelData[currLevel].tradeableItems[bestSellIndex]
		}
		if(bestBuyIndex > 0) {
			gossipText += " to buy " + levelData[currLevel].tradeableItems[bestBuyIndex]
		}
		gossipLocation = bestBuyLoc
	}
	return gossipText
}

function buyUpgrade(upgradeType, upgradeAmount, cost) {
	if(cost <= inv[3]) {
		switch(upgradeType) {
			case 'gossip':
				if(visitedAllLocations() && !showingGossipColors) {
					showingGossipColors = true
					inv[3] -= cost
					randomizeStore()
					typeText('"' + getGossipText() + '"', "Price Rumors: ", "Go Baby!")
					setupLocationRadioButtons()
					inventoryChanged = true
					gtag('event', 'gossip', {'event_category': 'upgradeBought', 'value': currLevel})
				}
				break
			case 'travel':
				if(travelTime[currLevel] > 1) {
					travelTime[currLevel]--
					inv[3] -= cost
					inventoryChanged = true
					if(travelTime[currLevel] > 1 + (visitedAllLocations() ? 0 : 1)) {
						typeText(locationName[currLevel][locIndex] + levelData[currLevel].travelFasterUpgradeMsg[0],
												"Travel Speed Upgraded.",
												"Go Baby!")
						gtag('event', 'travelSpeed', {'event_category': 'upgradeBought', 'event_label': 'intermediate', 'value': currLevel})
					} else {
						typeText(locationName[currLevel][locIndex] + levelData[currLevel].travelFasterUpgradeMsg[1],
												"Travel Speed Upgraded.",
												"Go Baby!")
						gtag('event', 'travelSpeed', {'event_category': 'upgradeBought', 'event_label': 'final', 'value': currLevel})
					}
				}
				break
			case 'cargo':
				cargoRoom += upgradeAmount
				inv[3] -= cost
				inventoryChanged = true
				typeText(locationName[currLevel][locIndex] + levelData[currLevel].cargoUpgradeMsg,
											"Cargo space upgraded.",
											"More Room!")
				gtag('event', 'cargo', {'event_category': 'upgradeBought', 'value': currLevel})
				break
			case 'level':
				if(maxLevel < levelData.length - 1) {
					maxLevel++
					inv[3] -= cost
					inventoryChanged = true
					document.getElementById('buttonIDlevelUp').style.visibility = 'visible'
					typeText(locationName[currLevel][locIndex] + levelData[currLevel].levelUpgradeMsg +
											" You can now advance to level " + (currLevel + 1) + " (\"" + levelData[currLevel].levelUpLabel + "\").",
											levelData[currLevel].levelUpgradeHeaderMsg,
											"Level " + maxLevel + " Available!")
					gtag('event', 'level', {'event_category': 'upgradeBought', 'value': maxLevel})
				} else {
					typeText("You have completed Baby Merchant! Hopefully more will be written soon.",
										"You win!", "Thanks for playing")
					gtag('event', 'win', {'event_category': 'gameState', 'value': currLevel})
				}
				break
		}
	} else {
		typeText("You need more " + levelData[currLevel].tradeableItems[3] + " to purchase this")
	}
}

function randomizeStore(initAll=false) {
	for(i = 1; i < inv.length; i++) {
		for(j = 0; j < levelData[currLevel].numLocations; j++) {
			if(initAll) {
				price[currLevel][j][i] = basePrice[i]
			}
			var formerPrice = price[currLevel][j][i]
			var newPrice = (formerPrice*2+basePrice[i])/3	// Trend back toward the basePrice
			var variancepct = 0.3
			if(Math.random() < 0.1) variancepct = 0.5 + Math.random()*0.45 // Sometimes have wild price swings
			newPrice = Math.round(newPrice + Math.random()*newPrice*variancepct*2 - newPrice*variancepct)
			if(newPrice > formerPrice*1.2 && formerPrice <= basePrice) {
				// Prices can sometimes get very high
				while(Math.random() < 0.7 && newPrice < basePrice[i]*10) newPrice = Math.round(newPrice*1.2)
			}
			price[currLevel][j][i] = newPrice
		}
	}
}

function updateLocomoteButton() {

	for(var i = 0; i < levelData[currLevel].numLocations; i++) {
		if(document.getElementById("nextLoc" + i).checked) {
			nextLocIndex = i
		}
	}
	var newLocomoteText = levelData[currLevel].locomotionType + " to "
	if(visitedLocation[currLevel][nextLocIndex]) {
		newLocomoteText += locationName[currLevel][nextLocIndex] +
															levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[nextLocIndex]
	} else {
		newLocomoteText += levelData[currLevel].locationLabel[nextLocIndex]
		if(nextLocIndex > 0) newLocomoteText += " #" + nextLocIndex
	}
	document.getElementById('buttonIDlocomote').innerHTML = newLocomoteText
}

function goBaby() {
	if(!typingText) {	// Can't do anything if we are still typing text
		var thisAction = buttonAction
		if(buttonAction != '') {

			var locomoteButton = document.getElementById('buttonIDlocomote')
			var pickButton = document.getElementById('buttonIDpick')
			var levelUpButton = document.getElementById('buttonIDlevelUp')
			var levelDownButton = document.getElementById('buttonIDlevelDown')

			var freeSpace = calculateFreeSpace()
			var spaceUsed = cargoRoom - freeSpace

			switch(thisAction) {
			case 'levelUp':
				if(inv[3] < 10 && getNetWorth() < 1000 ** (currLevel+2) &&
							oldInv[currLevel+1][1] == 0 &&
							oldInv[currLevel+1][2] == 0 &&
							oldInv[currLevel+1][3] == 0) {
					typeText("You should really have at least 10 " + levelData[currLevel].tradeableItems[3] +
										" before proceeding to level " + (currLevel + 1),
										"Get more " + levelData[currLevel].tradeableItems[3],
										"Too poor!")
				} else if(currLevel < maxLevel) {
					typeText(levelData[currLevel].levelUpMessage +
										", taking only your " + levelData[currLevel].tradeableItems[3] + " with you." +
										"\n\nNEW THIS LEVEL: " +
										levelData[currLevel].levelUpAwesomeness,
										"Advancing to level " + (currLevel+1) + ":",
										"Go Baby!")
					document.getElementById("destinationsAndLabel").style.display = "flex"

					// Preserve inventory that can't go up to the next level
					oldInv[currLevel] = [0,0,0,0]
					for(var i = 0; i < inv.length-1; i++) {
						oldInv[currLevel][i] = inv[i]
					}
					oldLocIndex[currLevel] = locIndex

					// This level's most expensive item is next level's currency
					inv[0] = inv[inv.length-1]
					currLevel++

					// Restore inventory from the last time we were on the higher level
					for(i = 1; i < inv.length; i++) {
						inv[i] = oldInv[currLevel][i]
					}
					oldInv[currLevel] = [0,0,0,0]
					locIndex = oldLocIndex[currLevel]
					nextLocIndex = locIndex + 1
					if(nextLocIndex > levelData[currLevel].numLocations) {
						nextLocIndex = 0
					}
					visitedLocation[currLevel][locIndex] = true
					upgradesVisible = false
					storeVisible = true
					randomizeStore(locIndex, true)
					levelDownButton.style.visibility = 'visible'
					levelDownButton.innerHTML = levelData[currLevel].levelDownLabel + locationName[currLevel][locIndex]  +
																				levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[locIndex]
					levelUpButton.innerHTML = levelData[currLevel].levelUpLabel
					levelUpButton.style.visibility = 'hidden'
					pickButton.style.display = 'none'
					setupLocationRadioButtons()
					setHeaderText(levelData[currLevel].VisitHdr1 + levelData[currLevel].characterType +
												levelData[currLevel].VisitHdr2 + locationName[currLevel][locIndex] +
												levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[locIndex])
					updateLocomoteButton()

					gtag('event', 'levelUp', {'event_category': 'levelChange', 'value': currLevel})
				}
				break
			case 'levelDown':
				if(currLevel > 0) {
					typeText(levelData[currLevel].levelDownMessage +
										", taking only your " + levelData[currLevel].tradeableItems[0] + " with you.",
										"Retreating to level " + (currLevel-1) + ":",
										"Humble thyself")
					// Preserve inventory that can't go down to the previous level
					oldInv[currLevel] = [0,0,0,0]
					for(var i = 1; i < inv.length; i++) {
						oldInv[currLevel][i] = inv[i]
					}
					setupLevel(currLevel-1, levelChildSeed[currLevel][locIndex], locationName[currLevel][locIndex])
					oldLocIndex[currLevel] = locIndex

					// This level's currency is next level's most expensive item
					inv[inv.length-1] = inv[0]
					currLevel--

					// Restore inventory from the last time we were on the lower level
					for(i = 0; i < inv.length-1; i++) {
						inv[i] = oldInv[currLevel][i]
					}
					oldInv[currLevel] = [0,0,0,0]
					locIndex = oldLocIndex[currLevel]
					storeVisible = false
					randomizeStore(locIndex, true)
					upgradesVisible = true
					levelDownButton.innerHTML = levelData[currLevel].levelDownLabel + locationName[currLevel][locIndex]  +
																				levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[locIndex]
					levelUpButton.innerHTML = levelData[currLevel].levelUpLabel
					levelUpButton.style.visibility = 'visible'
					if(currLevel == 0) {
						levelDownButton.style.visibility = 'hidden'
						document.getElementById("destinationsAndLabel").style.display = "none"
						pickButton.style.display = 'block'
					}

					setupLocationRadioButtons()
					setHeaderText(levelData[currLevel].VisitHdr1 + levelData[currLevel+1].characterType +
												levelData[currLevel].VisitHdr2 + locationName[currLevel][locIndex] +
												levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[locIndex])
					updateLocomoteButton()
					gtag('event', 'levelDown', {'event_category': 'levelChange', 'value': currLevel})
				}
				break
			case 'pick':
				if(locIndex == 0 && transitMoves == 0) {
					typeText(locationName[currLevel][locIndex] + " glares at you, and you decide to wait.")
				} else if(freeSpace == 0 && transitMoves > 0) {
					typeText("You would be overencumbered!")
				} else {
					pickButton.disabled = true
					var pickResult = Math.random()
					if(pickResult < 0.9) {
						inv[0]++
						typeText("You withdraw a " + levelData[currLevel].tradeableItemsSingular[0])
					} else if(pickResult < 0.99) {
						inv[1]++
						typeText("You draw forth a " + levelData[currLevel].tradeableItemsSingular[1] + "!")
					} else {
						inv[2]++
						typeText("To your incredible delight, you have drawn forth that rarest of boogers, the " + levelData[currLevel].tradeableItemsSingular[2] + "!",
											"You found a " + levelData[currLevel].tradeableItemsSingular[2] + "!!",
											positiveExclamation())
					}
				}
				setTimeout("document.getElementById('buttonIDpick').disabled = false", 40*PAUSE_MULT)
				break
			case 'locomote':
				if(freeSpace < 0) {
					typeText("You are overencumbered!")
				}	else if(nextLocIndex == locIndex) {
					typeText("You are already there!")
				} else {
					locomoteButton.disabled = true
					setTimeout("document.getElementById('buttonIDlocomote').disabled = false", 8*PAUSE_MULT)

					if(transitMoves == 0) {
						// Handle things related to departing a location
						document.getElementById("destinationsAndLabel").style.display = "none"
						transitMoves = travelTime[currLevel]
						storeVisible = false
						levelUpButton.style.visibility = 'hidden'
						levelDownButton.style.visibility = 'hidden'
						upgradesVisible = false
						if(!showingGossipColors) {
							randomizeStore()
						}
					}
					transitMoves--
					var ctype = levelData[currLevel].characterType
					if(nextLocIndex == 0) {
						if(currLevel+1 < levelData.length) {
							ctype = levelData[currLevel+1].characterType
						} else {
							ctype = 'evil baby'
						}
					}

					handleLostAndFound()

					if(transitMoves == 0) {
						// Handle things related to arriving at a location
						showingGossipColors = false
						locIndex = nextLocIndex
						nextLocIndex++
						if(nextLocIndex >= levelData[currLevel].numLocations) {
							nextLocIndex = 0
						}
						var coolLocationFooter = ""
						var coolLocationHeader = ""
						var locationMessage = ''
						if(currLevel > 0) {
							document.getElementById("destinationsAndLabel").style.display = "flex"
							if(locIndex > 0){
								levelDownButton.innerHTML = levelData[currLevel].levelDownLabel + locationName[currLevel][locIndex]  +
																							levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[locIndex]
								levelDownButton.style.visibility = 'visible'
							}
						}
						if(!visitedLocation[currLevel][locIndex]) {
							visitedLocation[currLevel][locIndex] = true
							if(visitedAllLocations()) {
								travelTime[currLevel]--
								var exploreMsg = levelData[currLevel].exploreMsg
								if(currLevel == 0) {
									var nextCtype = levelData[currLevel].characterType
									if(nextLocIndex == 0) {
										nextCtype = levelData[currLevel+1].characterType
									}
									exploreMsg += " Looking around, you see that continued thrashing will bring you full circle to revisit " +
												nextCtype + " " + locationName[currLevel][nextLocIndex] + "."
								}
								typeText(exploreMsg, "Exploration complete!", "Go Baby!")
								gtag('event', 'exploration', {'event_category': 'milestone', 'value': currLevel})
							}
							if(locIndex > 0) {
								locationMessage += levelData[currLevel].discoveryMsg1 + ctype +
											levelData[currLevel].discoveryMsg2 + locationName[currLevel][locIndex] +
											levelData[currLevel].discoveryMsg3

								if(!pickingEnabled) {
									pickButton.style.visibility = "visible"
									pickingEnabled = true
									locationMessage += " You notice " + locationName[currLevel][locIndex]  +
														" has a finger in each nostril. Hmmmm."
									coolLocationHeader = "Meeting " + ctype + " " + locationName[currLevel][locIndex] + ":"
									coolLocationFooter = "Nose picking is cool"
									gtag('event', 'picking', {'event_category': 'milestone', 'value': currLevel})
								}
							} else {
								locationMessage += levelData[currLevel].BossDiscoveryMsg1 + ctype +
											levelData[currLevel].BossDiscoveryMsg2 + locationName[currLevel][locIndex] +
											levelData[currLevel].BossDiscoveryMsg3 + levelData[currLevel].tradeableItems[3] +
											levelData[currLevel].BossDiscoveryMsg4
								coolLocationHeader = "Meeting " + ctype + " " + locationName[currLevel][locIndex] + ":"
								coolLocationFooter = "Upgrades for sale"
							}
						} else {
							locationMessage += levelData[currLevel].ArrivalMsg1 + locationName[currLevel][locIndex] +
										levelData[currLevel].ArrivalMsg2 + levelData[currLevel].locationLabel[locIndex] + "."
						}
						if(locIndex == 0) {
							if(currLevel < maxLevel) {
								levelUpButton.style.visibility = 'visible'
							}
						} else {
							if(!tradingEnabled && hasAnything() ) {
								tradingEnabled = true
								locationMessage += " " + locationName[currLevel][locIndex] +
											" seems to want to trade with you, but these wares look so expensive!" +
											" A voice resonates in your deepest being . . .  \"Buy low. Sell high.\""
								coolLocationHeader = "Meeting " + ctype + " " + locationName[currLevel][locIndex] + ":"
								coolLocationFooter = "Time to Trade!"
								gtag('event', 'trading', {'event_category': 'milestone', 'value': currLevel})
							}
						}
						typeText(locationMessage, coolLocationHeader, coolLocationFooter)
						setHeaderText(levelData[currLevel].VisitHdr1 + ctype +
									levelData[currLevel].VisitHdr2 + locationName[currLevel][locIndex] +
									levelData[currLevel].VisitHdr3 + levelData[currLevel].locationLabel[locIndex])

						if(tradingEnabled) {
							if(locIndex == 0) {
								upgradesVisible = true
							} else {
								storeVisible = true
							}
						}
					} else {  // transitMoves >= 0
			 			if(visitedLocation[currLevel][nextLocIndex]) {
							typeText(levelData[currLevel].RevisitMsg)
							setHeaderText(levelData[currLevel].RevisitHdr1 + locationName[currLevel][nextLocIndex] +
								 		levelData[currLevel].RevisitHdr2 + levelData[currLevel].locationLabel[nextLocIndex])
						} else {
							typeText(levelData[currLevel].ExploreMsg)
							setHeaderText(levelData[currLevel].ExploreHdr)
						}
					}
				}
				setupLocationRadioButtons()
				if(currLevel > 0 || visitedAllLocations()) {
					updateLocomoteButton()
				}

				break
			default:
				break
			}
		}

		if(buttonAction != '' || inventoryChanged) {
			// Get updated freeSpace and spaceUsed numbers
			var freeSpace = calculateFreeSpace()
			var spaceUsed = cargoRoom - freeSpace

			// Update inventory area
			var invHTML = ""
			var allUpgradesBought = true
			if(hasAnything()) {
				if(upgradesVisible) {
					invHTML += "<table class='collapseborder'>"
					invHTML += "<tr><td style=\"text-align:center\" class='singleborder'>Upgrade</td>" +
													"<td style=\"text-align:center\" class='singleborder'>Description</td>" +
													"<td style=\"text-align:center\" class='singleborder'>Price</td>" +
													"<td style=\"text-align:center\"></td></tr>"
					if(currLevel > 0 && visitedAllLocations() && !showingGossipColors) {
						var gossipPrice = 1 * (currLevel)
						invHTML += "<tr><td style=\"text-align:center\" class='singleborder'>Gossip</td>" +
														"<td style=\"text-align:center\" class='singleborder'>Price rumors</td>" +
														"<td style=\"text-align:center\" class='singleborder'>" +
														getDisplayNumber(gossipPrice, "yes") + "</td>" +
														"<td style=\"text-align:left\">"
						invHTML += '<button class="upgradeButton'
						if(inv[3] < gossipPrice) invHTML += ' greyButton'
						invHTML += '" onclick="buyUpgrade(\'gossip\',1,' + gossipPrice + ')">buy</button>'
						invHTML += "</td></tr>"
						allUpgradesBought = false
					}
					var travelPrice = 2 * (currLevel + 1)
					if(travelTime[currLevel] == 3 + (visitedAllLocations() ? 0 : 1)) {
						invHTML += "<tr><td style=\"text-align:center\" class='singleborder'>" +
														levelData[currLevel].travelFasterUpgradeDesc[0] + "</td>" +
														"<td style=\"text-align:center\" class='singleborder'>Travel faster</td>" +
														"<td style=\"text-align:center\" class='singleborder'>" +
														getDisplayNumber(travelPrice, "yes") + "</td>" +
														"<td style=\"text-align:left\">"
						invHTML += '<button class="upgradeButton'
						if(inv[3] < travelPrice) invHTML += ' greyButton'
						invHTML += '" onclick="buyUpgrade(\'travel\',1,' + travelPrice + ')">buy</button>'
						invHTML += "</td></tr>"
						allUpgradesBought = false
					} else if(travelTime[currLevel] == 2 + (visitedAllLocations() ? 0 : 1)) {
						travelPrice = 5 * (currLevel + 1)
						invHTML += "<tr><td style=\"text-align:center\" class='singleborder'>" + levelData[currLevel].travelFasterUpgradeDesc[1] + "</td>" +
														"<td style=\"text-align:center\" class='singleborder'>Travel faster</td>" +
														"<td style=\"text-align:center\" class='singleborder'>" +
														getDisplayNumber(travelPrice, "yes") + "</td>" +
														"<td style=\"text-align:left\">"
						invHTML += '<button class="upgradeButton'
						if(inv[3] < travelPrice) invHTML += ' greyButton'
						invHTML += '" onclick="buyUpgrade(\'travel\',1,' + travelPrice + ')">buy</button>'
						invHTML += "</td></tr>"
						allUpgradesBought = false
					}
					if(cargoRoom < 100 * (currLevel + 2)) {
						var cargoPrice = 10 * (currLevel + 1)
						invHTML += "<tr><td style=\"text-align:center\" class='singleborder'>" +
															levelData[currLevel].cargoUpgradeDesc + "</td>" +
															"<td style=\"text-align:center\" class='singleborder'>Hold 100 more</td>" +
															"<td style=\"text-align:center\" class='singleborder'>" +
															getDisplayNumber(cargoPrice, "yes") + "</td>" +
															"<td style=\"text-align:left\">"
						invHTML += '<button class="upgradeButton'
						if(inv[3] < cargoPrice) invHTML += ' greyButton'
						invHTML += '" onclick="buyUpgrade(\'cargo\',100,' + cargoPrice + ')">buy</button>'
						invHTML += "</td></tr>"
						allUpgradesBought = false
					}

					if(cargoRoom >= 100 * (currLevel + 2) && maxLevel == currLevel) {
						var levelPrice = 20 * (currLevel + 1)
						invHTML += "<tr><td style=\"text-align:center\" class='singleborder'>" +
														levelData[currLevel].levelUpgradeDesc + "</td>" +
														"<td style=\"text-align:center\" class='singleborder'>Travel further</td>" +
														"<td style=\"text-align:center\" class='singleborder'>" +
														getDisplayNumber(levelPrice, "yes") + "</td>" +
														"<td style=\"text-align:left\">"
						invHTML += '<button class="upgradeButton'
						if(inv[3] < levelPrice) invHTML += ' greyButton'
						invHTML += '" onclick="buyUpgrade(\'level\',1,' + levelPrice + ')">buy</button>'
						invHTML += "</td></tr>"
						allUpgradesBought = false
					}
					if(allUpgradesBought) {
						invHTML += "<tr><td colspan=3 style=\"text-align:center\" class='singleborder'>" +
												"<br>All upgrades on this level have been purchased!<br>&nbsp;</td><td></td></tr>"
					}
					invHTML += "</table>"
					invHTML += "Currency: " + getDisplayNumber(inv[3]) + " "
					if(inv[3] == 1) {
						invHTML += levelData[currLevel].tradeableItemsSingular[3]
					} else {
						invHTML += levelData[currLevel].tradeableItems[3]
					}
				}	else if(storeVisible) {
					invHTML += "<table class='collapseborder'>"
					invHTML += "<tr><td width=26% style=\"text-align:center\">Sell</td>" +
													"<td style=\"text-align:center\" class='singleborder'>Item</td>" +
													"<td style=\"text-align:center\" class='singleborder'>Price</td>" +
													"<td style=\"text-align:center\" class='singleborder'>Held</td>" +
													"<td width=26% style=\"text-align:center\">Buy</td></tr>"
					for(i = inv.length-1; i >= 1; i--) {
						var alertRed = 0
						var alertGreen = 0
						var displayPrice = price[currLevel][locIndex][i]
						if(displayPrice > basePrice[i]) {
							alertRed = Math.floor(255*2*(displayPrice/basePrice[i]-1))
							if(alertRed > 255) alertRed = 255
						} else if(displayPrice < basePrice[i]) {
							alertGreen = Math.floor(255*(basePrice[i]/displayPrice-1))
							if(alertGreen > 255) alertGreen = 255
						}
						var alertStyle = "style='text-align:center; color:rgb(" + alertRed + "," + alertGreen + ",0);'"
						invHTML += "<tr><td style=\"text-align:right\">"
						// Sell buttons
						var sellButtons = '<button class="tradeButton'
						if(inv[i] == 0) {
							sellButtons += ' greyButton'
						}
						sellButtons += '" onclick="sellInv(' + i + ',1)">'
						if(inv[i] <= 10) {
							sellButtons += 'sell '
						}
						sellButtons += '1</button>'
						var btnAmount = 10
						while(btnAmount < inv[i] && btnAmount <= 100) {
							sellButtons = '<button class="tradeButton" onclick="sellInv(' + i + ',' + btnAmount + ')">' + getDisplayNumber(btnAmount,"super") + '</button>' + sellButtons
							btnAmount *= 10
						}
						if(inv[i] > 1) {
							sellButtons = '<button class="tradeButton" onclick="sellInv(' + i + ',' + inv[i] + ')">all</button>' + sellButtons
						}
						invHTML += sellButtons
						invHTML += "</td><td class='singleborder' " + alertStyle + ">" + levelData[currLevel].tradeableItems[i]
						invHTML += "</td><td class='singleborder' " + alertStyle + ">" + displayPrice
						invHTML += "</td><td class='singleborder' style=\"text-align:center\">" + getDisplayNumber(inv[i], "yes")
						invHTML += "</td><td>"
						// Buy buttons
						var canBuy = Math.floor(inv[0]/displayPrice)
						var buyButtons = '<button class="tradeButton'
						if(canBuy == 0) {
							buyButtons += ' greyButton'
						}
						buyButtons += '" onclick="buyInv(' + i + ',1)">'
						if(canBuy <= 10) {
							buyButtons += 'buy '
						}
						buyButtons += '1</button>'
						btnAmount = 10
						while(btnAmount < canBuy && btnAmount <= 100) {
							buyButtons = buyButtons + '<button class=tradeButton onclick="buyInv(' + i + ',' + btnAmount + ')">' + getDisplayNumber(btnAmount,"super") + '</button>'
							btnAmount *= 10
						}
						if(canBuy > 1) {
							buyButtons = buyButtons + '<button class=tradeButton onclick="buyInv(' + i + ',' + canBuy + ')">all</button>'
						}
						invHTML += buyButtons
						invHTML += "</td></tr>"
					}
					invHTML += "</table><table>"
					invHTML += "<tr><td style=\"text-align:right\">" + getDisplayNumber(inv[0]) + "</td><td>"
					if(inv[0] == 1) {
						invHTML += levelData[currLevel].tradeableItemsSingular[0]
					} else {
						invHTML += levelData[currLevel].tradeableItems[0]
					}
					invHTML += " to spend</td></tr><tr>"
					if(freeSpace < 0) {
						if(inv[0] > 0) {
							var discardNum = -freeSpace
							if(discardNum > inv[0]) discardNum = inv[0]
							invHTML += "<td colspan=2><button class=discardButton onclick='inv[0] -= " + discardNum + "; inventoryChanged=true;'>Discard " + discardNum + " "
							if(inv[0] == 1) {
								invHTML += levelData[currLevel].tradeableItemsSingular[0]
							} else {
								invHTML += levelData[currLevel].tradeableItems[0]
							}
							invHTML += "</button></td></tr><tr>"
						}
							invHTML += "<td style=\"text-align:right; color:red;\">"
							invHTML += "You have " + freeSpace + "</td><td style=\"color:red;\">"
							invHTML += "too many items"
					} else {
						invHTML += "<td style=\"text-align:right\">"
						invHTML += "Room for " + freeSpace + "</td><td>"
						invHTML += "more items "
					}
					invHTML += "(" + spaceUsed + "/" + cargoRoom +
											")</td></tr></table>"
				} else {
					invHTML += "<table>"
					for(i = inv.length-1; i >= 0; i--) {
						if(inv[i] > 0) {
							invHTML += "<tr><td style=\"text-align:right\">" + getDisplayNumber(inv[i]) + "</td><td>"
							if(inv[i] == 1) {
								invHTML += levelData[currLevel].tradeableItemsSingular[i]
							} else {
								invHTML += levelData[currLevel].tradeableItems[i]
							}
							invHTML += "</td></tr>"
						}
					}
					invHTML += "<tr>"
					if(freeSpace < 0) {
						invHTML += "<td style=\"text-align:right; color:red;\">"
						invHTML += "You have " + freeSpace + "</td><td style=\"color:red;\">"
						invHTML += "too many items"
					} else {
						invHTML += "<td style=\"text-align:right\">"
						invHTML += "Room for " + freeSpace + "</td><td>"
						invHTML += "more items "
					}
					invHTML += "(" + spaceUsed + "/" + cargoRoom +
											")</td></tr></table>"
				}
			}
			setInventoryHTML(invHTML)

			var netWorth = getNetWorth()
			var statusText = '&nbsp;&nbsp;&nbsp;'
			if(netWorth > 0) {
				statusText += getDisplayNumber(netWorth) + " Æ€ - lv "
			} else {
				statusText += "level "
			}
			statusText += currLevel
			setStatusText(statusText)
			needToSave = true
		}

		buttonAction = ''
		inventoryChanged = false
	}
	setTimeout('goBaby()', 100)
}

function setupInitialActions() {
	setActionsHTML(
			getButtonHTML('locomote', 'thrash about')
			+ getButtonHTML('pick', 'pick nose')
			+ getButtonHTML('levelDown', levelData[currLevel].levelDownLabel)
			+ getButtonHTML('levelUp', levelData[currLevel].levelUpLabel)
		)
	document.getElementById('buttonIDlocomote').style.visibility = 'visible'
	setupLocationRadioButtons()
}

function clearGameVariables() {
	// Make sure all game variables are set to initial values
	// (not including values which persist between games)

	waitingTitleCards = 0
	waitingTitleHeader = []
	waitingTitleFooter = []
	waitingTitleText = []
	waitingTitleButton = []
	lastChar = ' '
	alreadyTyped = ''
	textBelow = ''
	textToType = []
	textToTypeBolded = []
	waitingMessagesToType = 0
	lastLineWasBold = false
	currLevel = 0
	locIndex = 0
	nextLocIndex = 1
	transitMoves = 4
	pickingEnabled = false
	tradingEnabled = false
	storeVisible = false
	upgradesVisible = false
	lastGameHTML = ""
	inv = [0,0,0,0]
	oldInv = []
	oldLocIndex = []
	travelTime = []
	visitedLocation = []
	cargoRoom = 100
	price = []
	locationName = []
	levelSeed = []
	levelChildSeed = []
	for(i = 0; i < levelData.length; i++) {
		oldInv[i] = [0,0,0,0]
		oldLocIndex[i] = 1
		travelTime[i] = 4
		visitedLocation[i] = []
		price[i] = []
		locationName[i] = []
		levelSeed[i] = 0
		levelChildSeed[i] = []
		for(j = 0; j < levelData[i].numLocations; j++) {
			visitedLocation[i][j] = false
			price[i][j] = [1,10,100,1000]
			locationName[i][j] = ""
		}
	}
	maxLevel = 0
	inventoryChanged = false
	showingGossipColors = false
	gossipLocation = 0
}

function startNewGame() {
		clearGameVariables()

		i = levelData.length-1
		setupLevel(i, Math.floor(Math.random()*Number.MAX_SAFE_INTEGER), "final boss")
		i--
		while(i >= 0) {
			setupLevel(i, levelChildSeed[i+1][1], locationName[i+1][1])
			i--
		}

		randomizeStore(true)
		setTimeout('setHeaderText("You are a " + levelData[0].characterType) ',10*PAUSE_MULT)
		setTimeout("setupInitialActions()", 50*PAUSE_MULT)
		setTimeout('goBaby()', 51*PAUSE_MULT)

		gtag('event', 'newGame', {'event_category': 'gameState'})
}

function askToContinue() {
	displayTitleCard("<button onclick='startNewGame(); hideTitleCard();' class='continueButton'>Start New Game</button><br><br>" +
									 "<button onclick='loadGameState(); hideTitleCard();'  class='continueButton'>Continue Previous Game</button>",
									 "ðŸ‘¶ Baby Merchant ðŸ‘¶", "", "")
}

var oldGameVersion = JSON.parse(localStorage.getItem('gameVersion'))
if(oldGameVersion == null || oldGameVersion != gameVersion) {
	startNewGame()
} else {
	setTimeout('askToContinue()',1)
}

	</script>

  <style type="text/css">

  /*
  CSS Code from here:
  http://stackoverflow.com/questions/18651345/gradient-opacity-on-the-bottom-of-div
  */
.gradientback{

    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
  	z-index: 10;
    background: -moz-linear-gradient(top,  rgba(255,255,255,0) 0%, rgba(255,255,255,0.90) 100%); /* FF3.6+ */
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,0)), color-stop(100%,rgba(255,255,255,0.90))); /* Chrome,Safari4+ */
    background: -webkit-linear-gradient(top, rgba(255,255,255,0) 0%,rgba(255,255,255,0.90) 100%); /* Chrome10+,Safari5.1+ */
    background: -o-linear-gradient(top,  rgba(255,255,255,0) 0%,rgba(255,255,255,0.90) 100%); /* Opera 11.10+ */
    background: -ms-linear-gradient(top,  rgba(255,255,255,0) 0%,rgba(255,255,255,0.90) 100%); /* IE10+ */
    background: linear-gradient(to bottom,  rgba(255,255,255,0) 0%,rgba(255,255,255,0.90) 100%); /* W3C */
    filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#fffffff00, endColorstr='#ffffffd8,GradientType=0 ); /* IE6-9 */

}

body {
	font-size:2vh;
}

.gameContainer {
	display: flex;
  align-items: center;
  flex-direction: column;
	position: absolute;
  padding: 10px;
	height: calc(100vh - 35px);
	width: calc(100vw - 35px);
	height: -webkit-fill-available;
	/* width: 100%;
  max-width: 100vw; */
}

.gameArea {
	width: 100%;
	max-width: 80vh;
  /* min-width: 400px; */
	margin: 0.3vh;
	padding: 0.7vh;
	overflow: hidden;
}

.bordered {
	border-width: 1px;
	border-style: solid;
	border-color: #DDDDDD;
}

.collapseborder {
	border-collapse: collapse;
	width: 100%;
	margin-bottom: 7px;
}

.singleborder {
	border-width: 1px;
	border-style: solid;
	border-color: #DDDDDD;
	padding-left: 2px;
	padding-right: 2px;
}

.headerWrapper {
	padding-top: 5px;
	padding-bottom: 5px;
	height: 3vh;
	align-items: flex-end;
	flex: 1 0 auto;
  flex-direction: row;
	display: none;
}

.headerText {
	flex: 1 0 auto;
}

.statusText {
	flex: 0 0 auto;
}

.inventoryWrapper {
  align-items: center;
  flex-direction: column;
	flex: 1 0 auto;
	display: none;
}

.controlsWrapper {
	flex-direction: column;
	flex: 1 0 auto;
	display: none;
}

.actionsWrapper {
	width: 100%;
	display: none;
	flex: 1 0 auto;
}

.destinationsContainer{
	width: 100%;
	display: none;
	flex: 1 0 auto;
	flex-direction: column;
}

.destinationsWrapper{
	width: 100%;
	display: flex;
	flex-direction: row;
	flex-wrap: wrap;
	flex: 1 0 auto;
}

.locChoice {
	padding-top: 4px;
	padding-left: 2px;
	padding-right: 2px;
}

.locChoiceLabel {
	padding-top: 6px;
}

.locRadioButton {
    vertical-align: middle;
}

.locRadioLabel {
    vertical-align: middle;
}

.locRadioLabelDisabled {
    vertical-align: middle;
		color: grey;
}

.outputAndGradientWrapper{
  position: relative;
  flex: 1 1 auto;
  height: 100%;
	visibility: hidden;
}

/* Footer isn't displayed - it's just here for flexbox */
.footerWrapper {
	display: flex;
  flex: 0 0 0px;
	padding: 0px;
}

.outputWrapper {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
	flex-direction: column;
	padding-top: 10px;

	/* Make text unselectable (blatantly stolen from ADR) */
	-webkit-touch-callout: none;
	-webkit-user-select: none;
	-khtml-user-select: none;
	-moz-user-select: none;
	-ms-user-select: none;
	user-select: none;
}

.outputSpan {
	display: flex;
	padding-left: 10px;
	padding-right: 10px;
}

button {
	background-color:transparent;
	border:0.1vh solid #dddddd;
	padding: 0.6vh;
	font-size: 1.7vh;
	margin-right: 1vh;
}

.babyButton{
	visibility: hidden;
}


.tradeButton{
	padding-bottom: 0.2vh;
	padding-top: 0.2vh;
	padding-left: 0.4vh;
	padding-right: 0.4vh;
	margin-left: 0.4vh;
	margin-right: 0.4vh;
}

.greyButton {
	color: grey;
}

.titleCard {
	display: none;
	flex-direction: column;
}

.titleCardMain {
	display: flex;
	width: 100%;
	max-width: 80vh;
  height: 100%;
	position: relative;
	align-items: center;
  flex: 1 1 auto;
}

.titleCardFooter {
	display: flex;
	width: 100%;
	max-width: 80vh;
	flex-direction: row;
  flex: 0 0 auto;
	margin-top: 8px;
  margin-bottom: 16px;
}

.titleCardBottomFloater {
	display: flex;
	width: 100%;
	max-width: 80vh;
	flex: 0 0 0px;
}

.titleCardHeader {
	display: flex;
	width: 100%;
	max-width: 80vh;
  flex: 0 0 auto;
	margin-bottom: 8px;
}

.titleCardMainText {
	padding: 15px;
	font-size: 3vh;
	text-align: center;
	width: 100%
}

.titleCardFooterText {
	padding: 15px;
	flex: 1 1 auto;
	font-size: 3vh;
}

.titleCardHeaderText {
	width: 100%;
	padding: 15px;
	font-size: 3vh;
	text-align: center;
}

.continueButton {
	flex: 0 0 auto;
	font-size: 3vh;
	margin: 9px;
}


  </style>
</head>
<body>
	<div id="normalGameGoesHere" class="gameContainer">
		<div id="headerGoesHere" class="gameArea bordered headerWrapper">
			<div id="headerTextGoesHere" class="headerText">
			</div>
			<div id="headerStatusGoesHere" class="statusText">
			</div>
		</div>
		<div id="controlsGoHere" class="gameArea bordered controlsWrapper">
			<div id="actionsGoHere" class="actionsWrapper">
			</div>
			<div id="destinationsAndLabel" class="destinationsContainer">
				<span id="destinationDescGoesHere" class="locChoiceLabel">Next destination:</span>
				<div id="destinationsGoHere" class="destinationsWrapper">
				</div>
			</div>
		</div>
		<div id="inventoryGoesHere" class="gameArea inventoryWrapper">
		</div>
		<div id="outputAndGradient" class="gameArea bordered outputAndGradientWrapper">
			<div id="textGradient"  class="gradientback">
			</div>
			<div id="outputGoesHere" class="outputWrapper">
			</div>
		</div>
		<div id="footerGoesHere" class="gameArea footerWrapper">
		</div>
	</div>
	<div id="titleCard" class="titleCard gameContainer">
		<div class="titleCardHeader bordered">
			<span id="titleHeaderTextGoesHere" class="titleCardHeaderText"></span>
		</div>
		<div class="titleCardMain bordered">
			<span id="titleMainTextGoesHere" class="titleCardMainText"></span>
		</div>
		<div id="titleCardFooter" class="titleCardFooter bordered">
			<span id="titleFooterTextGoesHere" class="titleCardFooterText"></span>
			<button id="continueButton" class="continueButton" onclick="hideTitleCard()">OK</button>
		</div>
		<div class="titleCardBottomFloater">
		</div>
	</div>
</body>
</html>
